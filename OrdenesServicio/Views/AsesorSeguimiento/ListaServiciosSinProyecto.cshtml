@using Infragistics.Web.Mvc
@model IQueryable<ZOE.OS.Modelo.Model.Complex.OSSeguimiento>

@{
    ViewBag.Title = "Lista de Servicios sin Proyecto";
    Layout = "~/Views/Shared/_LayoutPanel.cshtml";
}

<h2>Ordenes de Servicio Sin Proyecto Asignado</h2>

<script type="text/javascript">
    var rowSeleccionado;

    $(function () {
        $("#lista-servicio-seguimiento")
        .button()
        .click(function () {
            if (rowSeleccionado == null) {
                alert('Favor de seleccionar un ticket para ver el seguimiento')
                return false;
            }
        });
    });

    $('#gdOrdenes').live('iggridselectionrowselectionchanged', function (event, args) { RowSelectionChanged(args.row.index); });

    function RowSelectionChanged(row) {
        rowSeleccionado = row;
        var cell = $("#gdOrdenes").igGrid('cellAt', 0, row);
        var ticket = $(cell).text();
        var key = $('.selector').igGrid('option', 'primaryKey');
        $('input[name=ticketid]').val(ticket);
    }

</script>

@if (Model.Count() > 0)
{
 @(Html.Infragistics().Grid<ZOE.OS.Modelo.Model.Complex.OSSeguimiento>()
   .ID("gdOrdenes")
   .AutoGenerateColumns(false)
   .PrimaryKey("Ticket")
   .Columns(column =>
       {
           column.For(x => x.Ticket).DataType("long").HeaderText("No. Ticket");
           column.For(x => x.Descripcion).HeaderText("Descripción");
           column.For(x => x.Cliente).DataType("string").HeaderText("Cliente/Empresa");
           column.For(x => x.Contacto).DataType("string").HeaderText("Contacto");
           column.For(x => x.Status).DataType("string").HeaderText("Status");
           column.For(x => x.Asesor).HeaderText("Asesor Responsable");
           column.For(x => x.Fecha).HeaderText("Fecha Registro");
           column.For(x => x.FechaUlitmoMovimiento).HeaderText("Fecha Ultimo Movimiento");
       })
    .Features(features =>
        {
            features.Selection().Activation(true).Mode(SelectionMode.Row).MultipleSelection(false);
            features.Paging()
               .ShowPageSizeDropDown(false)
               .ShowPagerRecordsLabel(false)
                .PageSize(10)
                .PrevPageLabelText("Anterior")
                .NextPageLabelText("Siguiente")
                .PageSizeDropDownLabel("Mostrar")
                .PageSizeDropDownTrailingLabel("Registros");
            features.Sorting().Mode(SortingMode.Single).ColumnSettings(settings =>
                {
                    settings.ColumnSetting().ColumnKey("Ticket").AllowSorting(true);
                });
        })
                  .DataSourceUrl(Url.Action("ListaServiciosSinProyecto"))
    .DataBind()
    .Render()
   )
   
   <p></p>
   
   using (Html.BeginForm("VerSeguimiento", "AsesorSeguimiento", FormMethod.Post))
   {
      <input type="hidden" id='ticketid' name='ticketid' value='' /> 
      <input type="submit" id='lista-servicio-seguimiento' title='Ver y Agregar Actividades' name="btnSubmit" value="Seguimiento"/>
   }
}
else
{
    <p>No se encontraron registros</p>
}    